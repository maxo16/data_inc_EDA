knitr::opts_chunk$set(echo = TRUE)
library(data.table)
getwd()
sf_311 <- fread("/Users/max/Dropbox/Data Incubator/Application challenge/311_Cases.csv")
sf_311 <- fread("/Users/max/Dropbox/Data Incubator/311_Cases.csv")
class(sf_311)
View(sf_311)
sf_311 <- sf_311[,1:20]
length(unique(sf_311$Category))
# Quite a few categories, let's do a group by and see what sort of request volume there is by type. Could just narrow down to the most meaningful categories.
summary_by_category <- sf_311 %>% group_by(Category) %>% summarize("category_summary" = n())
# Let's make a percent of total column to get a better sense of what's going on.
summary_by_category$pct_of_total <- (summary_by_category$category_summary/sum(summary_by_category$category_summary))*100
summary_by_category <- summary_by_category[order(-summary_by_category$pct_of_total),]
summary_by_category$cumsum <- cumsum(summary_by_category$pct_of_total)
library(dplyr)
length(unique(sf_311$Category))
# Quite a few categories, let's do a group by and see what sort of request volume there is by type. Could just narrow down to the most meaningful categories.
summary_by_category <- sf_311 %>% group_by(Category) %>% summarize("category_summary" = n())
# Let's make a percent of total column to get a better sense of what's going on.
summary_by_category$pct_of_total <- (summary_by_category$category_summary/sum(summary_by_category$category_summary))*100
summary_by_category <- summary_by_category[order(-summary_by_category$pct_of_total),]
summary_by_category$cumsum <- cumsum(summary_by_category$pct_of_total)
class(sf_311
)
View(summary_by_category)
install.packages("treemap")
library(treemap)
# Tree map of all
treemap(summary_by_category, index = "Category", vSize = "pct_of_total", type = "index")
?treemap
# Tree map of all
treemap(summary_by_category, index = "Category", vSize = "pct_of_total", type = "index", title = "Percent of Total Calls")
# Tree map of top 10
treemap(summary_by_category[1:10,], index = "Category", vSize = "pct_of_total", type = "index", title = "Percent of Total Calls")
library(data.table)
library(dplyr)
library(treemap)
library(sf)
library(readr)
library(leaflet)
library(lubridate)
sf_311 <- fread("/Users/max/Dropbox/Data Incubator/311_Cases.csv")
sf_311 <- sf_311[,1:20]
length(unique(sf_311$Category))
# Quite a few categories, let's do a group by and see what sort of request volume there is by type. Could just narrow down to the most meaningful categories.
summary_by_category <- sf_311 %>% group_by(Category) %>% summarize("category_summary" = n())
# Let's make a percent of total column to get a better sense of what's going on.
summary_by_category$pct_of_total <- (summary_by_category$category_summary/sum(summary_by_category$category_summary))*100
summary_by_category <- summary_by_category[order(-summary_by_category$pct_of_total),]
summary_by_category$cumsum <- cumsum(summary_by_category$pct_of_total)
ba_bgs <- st_read("/Users/max/Dropbox/Stanford Stuff/Classes/PUBLPOL/Y23 Spring 2020/Thesis/Data/sf_bay_clipped/2e262912-207a-4424-9e17-08041688d59c202044-1-130emnv.fypm.shp")
population_data_bgs <- read_csv("~/Dropbox/Stanford Stuff/Classes/PUBLPOL/Y23 Spring 2020/Thesis/Data/population_data_bgs.csv")
ba_bgs <- ba_bgs[,c(6,10)]
ba_bgs$geoid_long <- paste("1500000US", ba_bgs$blkgrpid, sep = "")
ba_bgs <- ba_bgs[,c(2,3)]
ba_bgs <- ba_bgs %>% filter(geoid_long %in% population_data_bgs$id)
# Tree map of all
treemap(summary_by_category, index = "Category", vSize = "pct_of_total", type = "index", title = "Percent of Total Calls")
# Tree map of top 10
treemap(summary_by_category[1:10,], index = "Category", vSize = "pct_of_total", type = "index", title = "Percent of Total Calls, Top 10")
sf_311_streets <- st_as_sf(sf_311_streets, coords = c("Longitude", "Latitude"), crs = "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
sf_311_streets <- st_join(sf_311_streets, ba_bgs["geoid_long"])
sf_311_streets_summary <- sf_311_streets %>% group_by("geoid_long") %>% summarize("calls_bg" =)
sf_311_streets <- sf_311 %>% filter(Category == "Street and Sidewalk Cleaning")
sf_311_streets %>% group_by(`Request Details`) %>% summarize(n())
save.image()
class(sf_311_streets)
sf_311_streets <- sf_311 %>% filter(Category == "Street and Sidewalk Cleaning")
sf_311_streets <- st_as_sf(sf_311_streets, coords = c("Longitude", "Latitude"), crs = "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
sf_311_streets <- st_join(sf_311_streets, ba_bgs["geoid_long"])
sf_311_streets <- sf_311_streets %>% left_join(sf_311[,c(1,16,17)], by = "CaseID")
range(sf_311_streets$Latitude)
range(sf_311_streets$Longitude)
sf_311_streets <- sf_311_streets %>% filter(Longtitude >= -123 & Longitude <= -122 & Latitude >= 37.7 & Latitude <= 38)
range(sf_311_streets$Latitude)
range(sf_311_streets$Longitude)
sf_311_streets <- sf_311_streets %>% filter(Longitude >= -123 & Longitude <= -122 & Latitude >= 37.7 & Latitude <= 38)
View(sf_311_streets)
save.image()
plot(sf_311_streets["Status"])
length(unique(sf_311_streets$geoid_long))
sf_311_streets_summary <- sf_311_streets %>% group_by("geoid_long") %>% summarize("calls_bg" = n())
View(sf_311_streets_summary)
sf_311_streets_summary <- sf_311_streets %>% group_by(geoid_long) %>% summarize("calls_bg" = n())
View(sf_311_streets_summary)
plot(sf_311_streets_summary["calls_bg"])
View(ba_bgs)
# Join it back to the bgs then plot.
sf_311_streets_summary_bgs <- ba_bgs %>% left_join(sf_311_streets_summary)
# Join it back to the bgs then plot.
sf_311_streets_summary_bgs <- ba_bgs %>% left_join(sf_311_streets_summary, by = "geoid_long")
# Join it back to the bgs then plot.
sf_311_streets_summary_bgs <- ba_bgs %>% left_join(sf_311_streets_summary[,1:2], by = "geoid_long")
View(as.data.frame(sf_311_streets_summary))
# Join it back to the bgs then plot.
sf_311_streets_summary_bgs <- ba_bgs %>% left_join(as.data.frame(sf_311_streets_summary)[,1:2], by = "geoid_long")
View(sf_311_streets_summary_bgs)
plot(sf_311_streets_summary_bgs["calls_bg"])
range(sf_311_streets_summary_bgs$calls_bg)
range(sf_311_streets_summary_bgs$calls_bg, na.rm = TRUE)
sf_311_streets_summary_bgs <- sf_311_streets_summary_bgs[!is.na(sf_311_streets_summary_bgs$calls_bg),]
plot(sf_311_streets_summary_bgs["calls_bg"])
hist(sf_311_streets_summary_bgs["calls_bg"])
leaflet() %>%
addProviderTiles(providers$Stamen.Toner) %>% addPolygons(sf_311_streets_summary_bgs)
leaflet(sf_311_streets_summary_bgs) %>%
addProviderTiles(providers$Stamen.Toner) %>% addPolygons()
View(population_data_bgs)
range(population_data_bgs$`2017`)
sf_311_streets_summary_bgs <- sf_311_streets_summary_bgs %>% left_join(population_data_bgs[,c(1,15])
sf_311_streets_summary_bgs <- sf_311_streets_summary_bgs %>% left_join(population_data_bgs[,c(1,15)])
sf_311_streets_summary_bgs <- sf_311_streets_summary_bgs %>% left_join(population_data_bgs[,c(1,15)], by = c("geoid_long" = "id"))
plot(sf_311_streets_summary_bgs["2017"])
# Replace zeros with 1's.
sf_311_streets_summary_bgs[,sf_311_streets_summary_bgs$`2017` == 0]
# Replace zeros with 1's.
sf_311_streets_summary_bgs[sf_311_streets_summary_bgs$`2017` == 0,]
# Replace zeros with 1's.
View(sf_311_streets_summary_bgs[sf_311_streets_summary_bgs$`2017` == 0,])
# Replace zeros with 1's.
sf_311_streets_summary_bgs[sf_311_streets_summary_bgs$`2017` == 0,]$`2017` <- 1
range(sf_311_streets_summary_bgs$`2017`)
sf_311_streets_summary_bgs$calls_per_pop <- sf_311_streets_summary_bgs$calls_bg/sf_311_streets_summary_bgs$`2017`
plot(sf_311_streets_summary_bgs["calls_per_pop"])
hist(sf_311_streets_summary_bgs$calls_per_pop)
hist(filter(sf_311_streets_summary_bgs, calls_per_pop < 3000)$calls_per_pop)
range(sf_311_streets_summary_bgs$calls_per_pop)
class(filter(sf_311_streets_summary_bgs, calls_per_pop < 3000))
filter(sf_311_streets_summary_bgs, calls_per_pop < 3000)$calls_per_pop
range(filter(sf_311_streets_summary_bgs, calls_per_pop < 3000)$calls_per_pop)
hist(filter(sf_311_streets_summary_bgs, calls_per_pop < 2500)$calls_per_pop)
hist(filter(sf_311_streets_summary_bgs, calls_per_pop < 20)$calls_per_pop)
hist(filter(sf_311_streets_summary_bgs, calls_per_pop < 10)$calls_per_pop)
save.image
save.image()
library(data.table)
library(dplyr)
library(treemap)
library(sf)
library(readr)
library(leaflet)
library(lubridate)
View(summary_by_category)
# The dataset is fairly large and I don't need it all, let me filter down to the top four categories.
sf_311 <- sf_311 %>% filter(Category %in% summary_by_category$Category[1:4])
save.image()
hist(filter(sf_311_streets_summary_bgs, calls_per_pop < 10)$calls_per_pop)
View(sf_311_streets_summary_bgs)
scale(sf_311_streets_summary_bgs$calls_per_pop)
sf_311_streets_summary_bgs$z_score <- scale(sf_311_streets_summary_bgs$calls_per_pop)
(2.963491 - mean(sf_311_streets_summary_bgs$calls_per_pop)/sd(sf_311_streets_summary_bgs$calls_per_pop)
)
(2.963491 - mean(sf_311_streets_summary_bgs$calls_per_pop))/sd(sf_311_streets_summary_bgs$calls_per_pop)
hist(filter(sf_311_streets_summary_bgs, z_score <= 2)$calls_per_pop)
filter(sf_311_streets_summary_bgs, z_score <= 2)$calls_per_pop
range(sf_311_streets_summary_bgs$z_score)
range(filter(sf_311_streets_summary_bgs, z_score <= 2)$calls_per_pop)
range(sf_311_streets_summary_bgs$z_score)
range(filter(sf_311_streets_summary_bgs, z_score <= 2)$z_score)
sf_311_streets_summary_bgs$z_score <- scale(sf_311_streets_summary_bgs$calls_bg)
range(filter(sf_311_streets_summary_bgs, z_score <= 2)$z_score)
hist(sf_311_streets_summary_bgs$calls_bg)
hist(filter(sf_311_streets_summary_bgs, z_score <= 2)$calls_bg)
hist(filter(sf_311_streets_summary_bgs, z_score <= 2)$calls_bg, title = "Count of Calls Per BG")
hist(filter(sf_311_streets_summary_bgs, z_score <= 1.96)$calls_bg)
hist(filter(sf_311_streets_summary_bgs, z_score <= 2)$calls_bg)
hist(filter(sf_311_streets_summary_bgs, z_score <= 1.96)$calls_bg)
warnings()
hist(filter(sf_311_streets_summary_bgs, z_score <= 2)$calls_bg)
leaflet(sf_311_streets_summary_bgs) %>%
addProviderTiles(providers$Stamen.Toner) %>% addPolygons()
leaflet(sf_311_streets_summary_bgs) %>%
addProviderTiles(providers$Stamen.Toner) %>% addPolygons()
pal_red <- colorNumeric(
palette = "reds",
domain = filter(sf_311_streets_summary_bgs, z_score <= 2)$calls_bg
)
leaflet(filter(sf_311_streets_summary_bgs, z_score <= 2)) %>%
addProviderTiles(providers$Stamen.Toner) %>% addPolygons(stroke = FALSE, smoothFactor = 0.2, fillOpacity = 1,
color = ~pal(calls_bg))
leaflet(filter(sf_311_streets_summary_bgs, z_score <= 2)) %>%
addProviderTiles(providers$Stamen.Toner) %>% addPolygons(stroke = FALSE, smoothFactor = 0.2, fillOpacity = 1,
color = ~pal_red(calls_bg))
pal_red <- colorNumeric(
palette = "Reds",
domain = filter(sf_311_streets_summary_bgs, z_score <= 2)$calls_bg
)
leaflet(filter(sf_311_streets_summary_bgs, z_score <= 2)) %>%
addProviderTiles(providers$Stamen.Toner) %>% addPolygons(stroke = FALSE, smoothFactor = 0.2, fillOpacity = 1,
color = ~pal_red(calls_bg))
